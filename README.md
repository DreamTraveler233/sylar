# XinYu IM Backend

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![C++](https://img.shields.io/badge/language-C%2B%2B17-orange.svg)]()
[![Platform](https://img.shields.io/badge/platform-Linux-lightgrey.svg)]()

XinYu IM Backend æ˜¯ä¸€ä¸ªåŸºäº **C++17** å¼€å‘çš„é«˜æ€§èƒ½å³æ—¶é€šè®¯æœåŠ¡ç«¯ã€‚é¡¹ç›®é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œå®ç°äº† **ç½‘å…³åˆ†ç¦»** ä¸ **åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª**ï¼Œèƒ½å¤Ÿåœ¨ä¿è¯é«˜å¹¶å‘æ€§èƒ½çš„åŒæ—¶ï¼Œæä¾›æä½³çš„å¯ç»´æŠ¤æ€§ä¸å¯è§‚æµ‹æ€§ã€‚

## âœ¨ ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½å¹¶å‘æ¨¡å‹**ï¼šåŸºäº Libevent + åç¨‹ï¼ˆCoroutineï¼‰çš„éé˜»å¡ IO æ¨¡å‹ï¼Œè½»æ¾åº”å¯¹åŠ¨æ€é•¿è¿æ¥å‹åŠ›çš„åŒæ—¶ä¿æŒåŒæ­¥ä»£ç çš„ç¼–å†™ä½“éªŒã€‚
- ğŸ—ï¸ **ç½‘å…³åˆ†ç¦»æ¶æ„**ï¼š
  - **HTTP ç½‘å…³**: è´Ÿè´£ RESTful APIã€èº«ä»½é‰´æƒåŠä¸šåŠ¡é€»è¾‘è§¦å‘ã€‚
  - **WebSocket ç½‘å…³**: è´Ÿè´£é•¿è¿æ¥ç»´æŠ¤ã€å¿ƒè·³æ£€æµ‹åŠå®æ—¶æ¶ˆæ¯ä¸‹å‘ã€‚
- ğŸ”— **åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª**ï¼šå†…ç½®åç¨‹å®‰å…¨çš„ **Trace ID** è¿½è¸ªæœºåˆ¶ï¼Œæ”¯æŒè·¨ RPC èŠ‚ç‚¹çš„æ—¥å¿—æŸ“è‰²ï¼Œå®ç°å…¨é“¾è·¯è¯·æ±‚å®šä½ã€‚
- ğŸ›°ï¸ **æœåŠ¡å‘ç°ä¸è‡ªæ²»**ï¼šé›†æˆ ZooKeeper åŠ¨æ€æ³¨å†Œä¸å‘ç°æœåŠ¡èŠ‚ç‚¹ï¼Œæ”¯æŒæ°´å¹³æ‰©å®¹ä¸æ•…éšœæ„ŸçŸ¥ã€‚
- ğŸ“¦ **å¾®æœåŠ¡åŒ–æ¼”è¿›**ï¼šå·²å®ç°åª’ä½“æœåŠ¡ (`im_svc_media`) çš„è§£è€¦æ‹†åˆ†ï¼Œæ”¯æŒ Rock RPC è·¨è¿›ç¨‹é€šä¿¡ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å…ˆå†³æ¡ä»¶
- **æ“ä½œç³»ç»Ÿ**: Linux (æ¨è Ubuntu 20.04+)
- **ç¼–è¯‘å™¨**: GCC 9+ æˆ– Clang 11+
- **ä¾èµ–åº“**: Protobuf, OpenSSL, Zlib, YAML-cpp, JWT-cpp, MySQL Client, Hiredis, Libevent, ZooKeeper

### å®‰è£…æ­¥éª¤
```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/szy/XinYu-IM-Backend.git
cd XinYu-IM-Backend

# 2. å¯åŠ¨åŸºç¡€ä¾èµ–ç¯å¢ƒ (Redis, MySQL, ZooKeeper ç­‰)
./scripts/env/start_env.sh

# 3. æ‰§è¡Œæ•°æ®åº“è¿ç§»
./scripts/db/migrate.sh apply

# 4. ç¼–è¯‘é¡¹ç›®
./scripts/build.sh
```

### è¿è¡ŒæœåŠ¡
```bash
# ä¸€é”®å¯åŠ¨ HTTP ä¸ WebSocket æ‰€æœ‰ç½‘å…³æœåŠ¡
./scripts/deploy/gateways.sh start

# æ£€æŸ¥è¿è¡ŒçŠ¶æ€
./scripts/deploy/gateways.sh status
```

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
XinYu-IM-Backend/
â”œâ”€â”€ bin/                # ç¼–è¯‘äº§ç‰©ã€é…ç½®æ–‡ä»¶åŠæ—¥å¿—
â”‚   â”œâ”€â”€ config/         # ä¸šåŠ¡é…ç½®æ–‡ä»¶ (YAML)
â”‚   â””â”€â”€ log/            # æœåŠ¡è¿è¡Œæ—¥å¿—
â”œâ”€â”€ scripts/            # è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·é“¾
â”‚   â”œâ”€â”€ db/             # æ•°æ®åº“è¿ç§»è„šæœ¬
â”‚   â”œâ”€â”€ deploy/         # è¿›ç¨‹ç®¡ç†ä¸éƒ¨ç½²
â”‚   â”œâ”€â”€ env/            # åŸºç¡€è®¾æ–½ç®¡ç†
â”‚   â””â”€â”€ tests/          # å†’çƒŸæµ‹è¯•ä¸å‹æµ‹
â”œâ”€â”€ src/                # æ ¸å¿ƒæºä»£ç 
â”‚   â”œâ”€â”€ core/           # æ¡†æ¶åº•å±‚ (IO, åç¨‹, ç½‘ç»œ, è¿½è¸ª)
â”‚   â”œâ”€â”€ interface/      # æ¥å£å±‚ (HTTP/WS/RPC)
â”‚   â””â”€â”€ infra/          # åŸºç¡€è®¾æ–½é€‚é… (MySQL/Redis/Storage)
â””â”€â”€ migrations/         # æ•°æ®åº“ç‰ˆæœ¬è¿ç§» SQL
```

## ğŸ“– æ–‡æ¡£
- [åˆ†å¸ƒå¼é¡¹ç›®è®¡åˆ’ä¹¦](docs/åˆ†å¸ƒå¼IMæœåŠ¡å™¨é¡¹ç›®è®¡åˆ’ä¹¦.md)
- [æœåŠ¡å‘ç°çº¦å®š](docs/service_discovery_convention.md)
- [è„šæœ¬ç›®å½•ä½¿ç”¨è¯´æ˜](scripts/README.md)

## ğŸ¤ è´¡çŒ®
æ¬¢è¿æäº¤ Issue æˆ– PRã€‚åœ¨æäº¤ä»£ç å‰è¯·ç¡®ä¿ï¼š
1. è¯·è¿è¡Œ `.clang-format` æ ¼å¼åŒ–ä»£ç ã€‚
2. è¿è¡Œ `./scripts/tests/smoke/api_smoke.sh` ç¡®ä¿æ ¸å¿ƒæµç¨‹é€šè¿‡ã€‚

## ğŸ“„ è®¸å¯è¯
æœ¬é¡¹ç›®åŸºäº [MIT License](LICENSE) å¼€æºã€‚

## ğŸ™ è‡´è°¢
- [Libevent](https://libevent.org/) - ç½‘ç»œåº•åº§
- [hiredis-vip](https://github.com/vipshop/hiredis-vip) - Redis å®¢æˆ·ç«¯
